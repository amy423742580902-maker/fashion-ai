<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI ç©¿æ­å»ºè­°å°å¹«æ‰‹ï¼ˆIndexedDB ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:system-ui;
  background:#f5f5f7;
  color:#222;
}
header{
  background:linear-gradient(120deg,#fbc2eb,#a6c1ee);
  padding:20px;
}
main{
  display:flex;
  flex-wrap:wrap;
  gap:16px;
  padding:16px;
}
.panel{
  background:white;
  padding:16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
.left{flex:3 1 600px;}
.right{flex:1 1 280px;}

.upload-section{
  border:2px dashed #ccc;
  padding:12px;
  border-radius:12px;
  margin-bottom:16px;
}
.upload-title{
  font-weight:700;
  font-size:1.1rem;
  margin-bottom:6px;
}

.image-grid{
  margin-top:10px;
  display:grid;
  grid-template-columns:repeat(auto-fill,100px);
  gap:10px;
}
.thumb-box{
  width:100px;
  height:100px;
  position:relative;
}
.thumb{
  width:100%;
  height:100%;
  border-radius:10px;
  object-fit:cover;
  border:1px solid #ddd;
}
.delete-btn{
  position:absolute;
  top:-6px;
  right:-6px;
  background:#ff4d4d;
  width:22px;
  height:22px;
  border-radius:50%;
  border:none;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
.thumb-badge{
  position:absolute;
  left:4px;
  bottom:4px;
  background:rgba(0,0,0,0.7);
  color:#fff;
  font-size:9px;
  padding:2px 4px;
  border-radius:6px;
  line-height:1.2;
}

button{
  padding:8px 12px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}
button.primary{
  background:#ff7eb3;
  color:white;
}
.history-btn{
  margin-top:12px;
  width:100%;
  background:#4a90e2;
  color:white;
}
.clear-btn{
  margin-top:12px;
  width:100%;
  background:#ff6b6b;
  color:white;
}
</style>
</head>

<body>

<header>
  <h1>ä½ çš„è¡£æ«¥ï½œAI ç©¿æ­å»ºè­°å°å¹«æ‰‹</h1>
  <p>é™¤éŒ¯ç‰ˆï¼šé¡¯ç¤ºè¡£ç‰©åˆ¤æ–·çµæœï¼Œæ–¹ä¾¿å„ªåŒ–åˆ†é¡é‚è¼¯</p>
</header>

<main>
  <section class="panel left">
    <h2>ä½ çš„è¡£æ«¥</h2>

    <!-- ä¸Šè¡£ -->
    <div class="upload-section">
      <div class="upload-title">ğŸ‘• ä¸Šè¡£</div>
      <input type="file" id="uploadTop" accept="image/*" multiple>
      <div id="topGrid" class="image-grid"></div>
    </div>

    <!-- ä¸‹è‘— -->
    <div class="upload-section">
      <div class="upload-title">ğŸ‘– ä¸‹è‘—</div>
      <input type="file" id="uploadBottom" accept="image/*" multiple>
      <div id="bottomGrid" class="image-grid"></div>
    </div>

    <!-- å¤–å¥— -->
    <div class="upload-section">
      <div class="upload-title">ğŸ§¥ å¤–å¥—</div>
      <input type="file" id="uploadOuter" accept="image/*" multiple>
      <div id="outerGrid" class="image-grid"></div>
    </div>

    <!-- é‹å­ -->
    <div class="upload-section">
      <div class="upload-title">ğŸ‘Ÿ é‹å­</div>
      <input type="file" id="uploadShoes" accept="image/*" multiple>
      <div id="shoesGrid" class="image-grid"></div>
    </div>

    <!-- é…ä»¶ -->
    <div class="upload-section">
      <div class="upload-title">ğŸ’ é…ä»¶</div>
      <input type="file" id="uploadAcc" accept="image/*" multiple>
      <div id="accGrid" class="image-grid"></div>
    </div>

    <!-- æ–°å¢ï¼šæ¸…ç©ºè¡£æ«¥ -->
    <button class="clear-btn" id="clearWardrobeBtn">
      ğŸ—‘ æ¸…ç©ºè¡£æ«¥ï¼ˆæ¸¬è©¦ç”¨ï¼‰
    </button>

    <button class="history-btn" onclick="location.href='history.html'">
      ğŸ“œ æŸ¥çœ‹ç©¿æ­æ­·å²
    </button>
  </section>

  <aside class="panel right">
    <h2>ä»Šæ—¥ç©¿æ­</h2>
    <button class="primary" id="genBtn">ç”Ÿæˆç©¿æ­</button>
    <div id="outfit"></div>
  </aside>
</main>

<script>
let tops=[], bottoms=[], outers=[], shoes=[], accs=[];
let db;
const DB_NAME="WardrobeDB";
const STORE_NAME="clothes";

/* IndexedDB åˆå§‹åŒ– */
function initDB(){
  return new Promise((resolve)=>{
    const req=indexedDB.open(DB_NAME,1);
    req.onupgradeneeded=e=>{
      db=e.target.result;
      if(!db.objectStoreNames.contains(STORE_NAME)){
        db.createObjectStore(STORE_NAME,{keyPath:"id"});
      }
    };
    req.onsuccess=e=>{
      db=e.target.result;
      loadClothesFromDB();
      resolve();
    };
  });
}

/* æ¸…ç©ºè¡£æ«¥ */
function clearWardrobe(){
  if(!confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¡£ç‰©å—ï¼Ÿ")) return;
  const tx=db.transaction([STORE_NAME],"readwrite");
  tx.objectStore(STORE_NAME).clear();
  tops.length=bottoms.length=outers.length=shoes.length=accs.length=0;
  ["topGrid","bottomGrid","outerGrid","shoesGrid","accGrid"]
    .forEach(id=>document.getElementById(id).innerHTML="");
  alert("è¡£æ«¥å·²æ¸…ç©ºï¼Œè«‹é‡æ–°ä¸Šå‚³åœ–ç‰‡");
}
document.getElementById("clearWardrobeBtn").onclick=clearWardrobe;

/* æ¸²æŸ“è¡£æ«¥ï¼ˆå«é™¤éŒ¯è³‡è¨Šï¼‰ */
function renderGrid(list, gridId){
  const grid=document.getElementById(gridId);
  grid.innerHTML="";
  list.forEach((item,i)=>{
    const box=document.createElement("div");
    box.className="thumb-box";
    box.innerHTML=`
      <img src="${item.url}" class="thumb">
      <button class="delete-btn">Ã—</button>
      <div class="thumb-badge">
        ${item.colorName}<br>
        ratio:${item.ratio?.toFixed(2)}<br>
        ${item.clothingType}
      </div>
    `;
    box.querySelector(".delete-btn").onclick=()=>{
      deleteClothFromDB(item.id);
      list.splice(i,1);
      renderGrid(list,gridId);
    };
    grid.appendChild(box);
  });
}

/* è¼‰å…¥è¡£æ«¥ */
function loadClothesFromDB(){
  const tx=db.transaction([STORE_NAME],"readonly");
  tx.objectStore(STORE_NAME).getAll().onsuccess=e=>{
    tops=[];bottoms=[];outers=[];shoes=[];accs=[];
    e.target.result.forEach(item=>{
      if(item.category==="top") tops.push(item);
      if(item.category==="bottom") bottoms.push(item);
      if(item.category==="outer") outers.push(item);
      if(item.category==="shoes") shoes.push(item);
      if(item.category==="acc") accs.push(item);
    });
    renderGrid(tops,"topGrid");
    renderGrid(bottoms,"bottomGrid");
    renderGrid(outers,"outerGrid");
    renderGrid(shoes,"shoesGrid");
    renderGrid(accs,"accGrid");
  };
}

/* åˆªé™¤å–®ä»¶ */
function deleteClothFromDB(id){
  db.transaction([STORE_NAME],"readwrite").objectStore(STORE_NAME).delete(id);
}

initDB();
</script>
</body>
</html>
