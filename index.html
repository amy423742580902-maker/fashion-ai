<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI ç©¿æ­å»ºè­°å°å¹«æ‰‹</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui;background:#f5f5f7;color:#222;}
header{background:linear-gradient(120deg,#fbc2eb,#a6c1ee);padding:20px;}
main{display:flex;flex-wrap:wrap;gap:16px;padding:16px;}
.panel{background:white;padding:16px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.left{flex:3 1 600px;}
.right{flex:1 1 280px;}

.upload-section{border:2px dashed #ccc;padding:12px;border-radius:12px;margin-bottom:16px;}
.upload-title{font-weight:700;margin-bottom:6px;}
.image-grid{display:grid;grid-template-columns:repeat(auto-fill,100px);gap:10px;margin-top:8px;}
.thumb-box{position:relative;width:100px;height:100px;}
.thumb{width:100%;height:100%;object-fit:cover;border-radius:8px;border:1px solid #ccc;}
.delete-btn{position:absolute;top:-6px;right:-6px;background:#ff4d4d;color:white;border:none;border-radius:50%;width:22px;height:22px;cursor:pointer;}

button{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;}
.primary{background:#ff7eb3;color:white;}
.save-btn{background:#4a90e2;color:white;margin-top:10px;display:none;}

.outfit-img{width:100%;max-width:180px;border-radius:10px;margin-top:6px;}
.outfit-item{margin-bottom:14px;}
.outfit-label{font-weight:bold;margin-bottom:4px;}
select{width:100%;margin-bottom:8px;padding:6px;border-radius:8px;}
</style>
</head>

<body>
<header>
  <h1>ä½ çš„è¡£æ«¥ï½œAI ç©¿æ­å»ºè­°å°å¹«æ‰‹</h1>
  <p>å»¶å¾Œæ±ºç­– Ã— ä½¿ç”¨è€…ç¢ºèª Ã— ç©©å®šæ¨è–¦</p>
</header>

<main>
<section class="panel left">
  <h2>ä½ çš„è¡£æ«¥</h2>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘• ä¸Šè¡£</div>
    <input type="file" id="uploadTop" multiple>
    <div id="topGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘– ä¸‹è‘—</div>
    <input type="file" id="uploadBottom" multiple>
    <div id="bottomGrid" class="image-grid"></div>
  </div>
</section>

<aside class="panel right">
  <h2>ç©¿æ­æ¢ä»¶</h2>

  <select id="styleSelect">
    <option value="casual">ä¼‘é–’</option>
    <option value="minimal">æ¥µç°¡</option>
    <option value="dopamine">å¤šå·´èƒº</option>
    <option value="formal">æ­£å¼</option>
  </select>

  <select id="weatherSelect">
    <option value="hot">ç‚ç†±</option>
    <option value="cool">æ¶¼çˆ½</option>
    <option value="cold">å¯’å†·</option>
  </select>

  <button class="primary" id="genBtn">ç”Ÿæˆç©¿æ­</button>

  <h3>ç©¿æ­çµæœ</h3>
  <div id="outfit"></div>
  <button class="save-btn" id="saveBtn">â¤ï¸ å„²å­˜é€™å¥—ç©¿æ­</button>
</aside>
</main>

<script>
// ===== è¡£æ«¥è³‡æ–™ =====
let tops=[], bottoms=[];
let currentOutfit=null;

// ===== ä¸Šå‚³ =====
uploadTop.onchange=e=>loadImages(e,tops,"topGrid","top");
uploadBottom.onchange=e=>loadImages(e,bottoms,"bottomGrid","bottom");

function loadImages(e,list,gridId,category){
  [...e.target.files].forEach(file=>{
    const r=new FileReader();
    r.onload=()=>{
      const img=new Image();
      img.onload=()=>{
        list.push({
          url:r.result,
          ratio:img.height/img.width,
          category
        });
        render(gridId,list);
      };
      img.src=r.result;
    };
    r.readAsDataURL(file);
  });
}

function render(gridId,list){
  const g=document.getElementById(gridId);
  g.innerHTML="";
  list.forEach((item,i)=>{
    const d=document.createElement("div");
    d.className="thumb-box";
    d.innerHTML=`<img src="${item.url}" class="thumb"><button class="delete-btn">Ã—</button>`;
    d.querySelector("button").onclick=()=>{list.splice(i,1);render(gridId,list);}
    g.appendChild(d);
  });
}

// ===== æ¨è–¦æ ¸å¿ƒï¼ˆè©•åˆ†åˆ¶ï¼‰=====
function score(item,weather){
  let s=Math.random();
  if(weather==="hot")  s+=item.ratio<1.3?2:-1;
  if(weather==="cold")s+=item.ratio>1.3?2:-1;
  if(item._used) s-=1;
  return s;
}

function pick(list,weather){
  if(!list.length) return null;
  const sorted=list.map(i=>({i,sc:score(i,weather)}))
    .sort((a,b)=>b.sc-a.sc);
  sorted[0].i._used=true;
  return sorted[0].i;
}

// ===== ç”Ÿæˆç©¿æ­ï¼ˆåªç”Ÿæˆï¼Œä¸å„²å­˜ï¼‰=====
genBtn.onclick=()=>{
  outfit.innerHTML="";
  saveBtn.style.display="none";

  const weather=weatherSelect.value;
  const top=pick(tops,weather);
  const bottom=pick(bottoms,weather);

  if(!top||!bottom){
    outfit.innerHTML="<p>è«‹è‡³å°‘ä¸Šå‚³ä¸€ä»¶ä¸Šè¡£èˆ‡ä¸‹è‘—ã€‚</p>";
    return;
  }

  currentOutfit={top,bottom,weather,date:new Date().toLocaleString("zh-Hant")};

  show("ğŸ‘• ä¸Šè¡£",top);
  show("ğŸ‘– ä¸‹è‘—",bottom);

  // âš ï¸ é—œéµï¼šç•«é¢é¡¯ç¤ºå®Œæˆå¾Œï¼Œæ‰å‡ºç¾å„²å­˜æŒ‰éˆ•
  saveBtn.style.display="block";
};

function show(label,item){
  outfit.innerHTML+=`
    <div class="outfit-item">
      <div class="outfit-label">${label}</div>
      <img src="${item.url}" class="outfit-img">
    </div>`;
}

// ===== ä½¿ç”¨è€…ä¸»å‹•å„²å­˜ =====
saveBtn.onclick=()=>{
  if(!currentOutfit) return;
  const h=JSON.parse(localStorage.getItem("outfitHistory")||"[]");
  h.push(currentOutfit);
  localStorage.setItem("outfitHistory",JSON.stringify(h));
  alert("å·²å„²å­˜åˆ°ç©¿æ­æ­·å²");
};
</script>
</body>
</html>
