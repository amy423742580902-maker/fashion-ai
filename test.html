<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI ç©¿æ­å»ºè­°å°å¹«æ‰‹ï¼ˆIndexedDB ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui;background:#f5f5f7;color:#222;}
header{background:linear-gradient(120deg,#fbc2eb,#a6c1ee);padding:20px;}
main{display:flex;flex-wrap:wrap;gap:16px;padding:16px;}
.panel{background:white;padding:16px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.left{flex:3 1 600px;}
.right{flex:1 1 280px;}

.upload-section{border:2px dashed #ccc;padding:12px;border-radius:12px;margin-bottom:16px;}
.upload-title{font-weight:700;font-size:1.05rem;margin-bottom:6px;}

.image-grid{display:grid;grid-template-columns:repeat(auto-fill,100px);gap:10px;}
.thumb-box{width:100px;height:100px;position:relative;}
.thumb{width:100%;height:100%;object-fit:cover;border-radius:10px;border:1px solid #ddd;}
.delete-btn{
  position:absolute;top:-6px;right:-6px;
  background:#ff4d4d;width:22px;height:22px;
  border-radius:50%;border:none;color:white;font-weight:bold;cursor:pointer;
}

button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer;}
button.primary{background:#ff7eb3;color:white;}
.history-btn{margin-top:12px;width:100%;background:#4a90e2;color:white;}

.outfit-img{width:100%;max-width:180px;border-radius:10px;margin-top:6px;}
.outfit-item{margin-bottom:12px;}
.outfit-label{font-weight:bold;margin-bottom:4px;}
.outfit-meta{font-size:12px;color:#555;margin-top:4px;}

select{padding:6px 10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;}

#saveOutfitBtn{
  display:none;
  width:100%;
  margin-top:10px;
  background:#4a90e2;
  color:white;
}
</style>
</head>

<body>

<header>
  <h1>ä½ çš„è¡£æ«¥ï½œAI ç©¿æ­å»ºè­°å°å¹«æ‰‹</h1>
  <p>ç‚ç†±ï¼çŸ­è¢–çŸ­è¤²ï½œå¯’å†·ï¼é•·è¢–é•·è¤²ï¼ˆå¼·åˆ¶è¦å‰‡ï¼‰</p>
</header>

<main>
<section class="panel left">
  <h2>ä½ çš„è¡£æ«¥</h2>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘• ä¸Šè¡£ï¼ˆçŸ­è¢–ï¼‰</div>
    <input type="file" id="uploadTopShort" accept="image/*" multiple>
    <div id="topShortGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘• ä¸Šè¡£ï¼ˆé•·è¢–ï¼‰</div>
    <input type="file" id="uploadTopLong" accept="image/*" multiple>
    <div id="topLongGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘– ä¸‹è‘—ï¼ˆçŸ­è¤² / è£™ï¼‰</div>
    <input type="file" id="uploadBottomShort" accept="image/*" multiple>
    <div id="bottomShortGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘– ä¸‹è‘—ï¼ˆé•·è¤² / é•·è£™ï¼‰</div>
    <input type="file" id="uploadBottomLong" accept="image/*" multiple>
    <div id="bottomLongGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ§¥ å¤–å¥—</div>
    <input type="file" id="uploadOuter" accept="image/*" multiple>
    <div id="outerGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ‘Ÿ é‹å­</div>
    <input type="file" id="uploadShoes" accept="image/*" multiple>
    <div id="shoesGrid" class="image-grid"></div>
  </div>

  <div class="upload-section">
    <div class="upload-title">ğŸ’ é…ä»¶</div>
    <input type="file" id="uploadAcc" accept="image/*" multiple>
    <div id="accGrid" class="image-grid"></div>
  </div>

  <button class="history-btn" onclick="location.href='history.html'">ğŸ“œ æŸ¥çœ‹ç©¿æ­æ­·å²</button>
</section>

<aside class="panel right">
  <h2>ä»Šæ—¥ç©¿æ­é¸é …</h2>

  <label>é¢¨æ ¼ï¼š</label>
  <select id="styleSelect">
    <option value="casual">ä¼‘é–’æ–‡é’</option>
    <option value="minimal">æ¥µç°¡</option>
    <option value="dopamine">å¤šå·´èƒº</option>
    <option value="sporty">é‹å‹•</option>
    <option value="formal">æ­£å¼</option>
  </select>

  <label>å¤©æ°£ï¼š</label>
  <select id="weatherSelect">
    <option value="hot">ç‚ç†±</option>
    <option value="cool">æ¶¼çˆ½</option>
    <option value="windy">é¢¨å¤§</option>
    <option value="rainy">ä¸‹é›¨</option>
    <option value="cold">å¯’å†·</option>
  </select>

  <button class="primary" id="genBtn">ç”Ÿæˆç©¿æ­</button>

  <h3>ç©¿æ­çµæœ</h3>
  <div id="outfit"></div>
  <button id="saveOutfitBtn">â¤ï¸ å„²å­˜é€™å¥—ç©¿æ­</button>
</aside>
</main>

<script>
// ========= å…¨åŸŸ =========
let tops=[], bottoms=[], shoes=[], accs=[];
let currentOutfit = null;

// ========= ä¸Šå‚³ =========
uploadTopShort.onchange=e=>add(e,tops,"short-sleeve");
uploadTopLong.onchange=e=>add(e,tops,"long-sleeve");
uploadBottomShort.onchange=e=>add(e,bottoms,"shorts");
uploadBottomLong.onchange=e=>add(e,bottoms,"long-pants");
uploadShoes.onchange=e=>add(e,shoes,"shoes");
uploadAcc.onchange=e=>add(e,accs,"acc");

function add(e,list,type){
  [...e.target.files].forEach(f=>{
    const r=new FileReader();
    r.onload=()=>{
      list.push({url:r.result,clothingType:type});
      render();
    };
    r.readAsDataURL(f);
  });
}

function render(){
  renderGrid(tops,topShortGrid,"short");
  renderGrid(tops,topLongGrid,"long");
  renderGrid(bottoms,bottomShortGrid,"short");
  renderGrid(bottoms,bottomLongGrid,"long");
  renderGrid(shoes,shoesGrid);
  renderGrid(accs,accGrid);
}
  
function renderGrid(list,grid,filter){
  grid.innerHTML="";
  list.filter(i=>!filter||i.clothingType.includes(filter))
      .forEach(i=>{
        grid.innerHTML+=`<img src="${i.url}" class="thumb">`;
      });
}

// ========= ç”Ÿæˆ =========
genBtn.onclick=()=>{
  outfit.innerHTML="";
  saveOutfitBtn.style.display="none";
  currentOutfit=null;

  let tp=[...tops], bp=[...bottoms];
  if(weatherSelect.value==="hot"){
    tp=tp.filter(i=>i.clothingType==="short-sleeve");
    bp=bp.filter(i=>i.clothingType==="shorts");
  }
  if(weatherSelect.value==="cold"){
    tp=tp.filter(i=>i.clothingType==="long-sleeve");
    bp=bp.filter(i=>i.clothingType==="long-pants");
  }

  const pick=a=>a[Math.floor(Math.random()*a.length)];
  const top=tp.length?pick(tp):null;
  const bottom=bp.length?pick(bp):null;
  const shoe=shoes.length?pick(shoes):null;
  const acc=accs.length&&Math.random()<0.5?pick(accs):null;

  show("ğŸ‘• ä¸Šè¡£",top);
  show("ğŸ‘– ä¸‹è‘—",bottom);
  show("ğŸ‘Ÿ é‹å­",shoe);
  show("ğŸ’ é…ä»¶",acc);

  if(top||bottom){
    currentOutfit={top,bottom,shoe,acc,date:new Date().toLocaleString("zh-Hant")};
    saveOutfitBtn.style.display="block";
  }
};

function show(label,item){
  if(!item)return;
  outfit.innerHTML+=`
    <div class="outfit-item">
      <div class="outfit-label">${label}</div>
      <img src="${item.url}" class="outfit-img">
    </div>`;
}

// ========= å„²å­˜ =========
saveOutfitBtn.onclick=()=>{
  if(!currentOutfit)return;
  const h=JSON.parse(localStorage.getItem("outfitHistory")||"[]");
  h.push(currentOutfit);
  localStorage.setItem("outfitHistory",JSON.stringify(h));
  saveOutfitBtn.style.display="none";
  currentOutfit=null;
};
</script>

</body>
</html>
